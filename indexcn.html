<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta id="_moz_html_fragment">
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-581509-4', 'teawater.github.io');
ga('send', 'pageview');

</script>
<title>C/C++ 动态内存分析器 (CMA)</title>
</head>
<body>
<div style="text-align: center;">
<a href="index.html">英文</a><br>
</div>
<br>
<table
style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
border="1" cellpadding="0" cellspacing="0">

<tr align="center">
<td style="vertical-align: top;"><a href="https://github.com/teawater/cma">https://github.com/teawater/cma</a>
</td>
</tr>

<tr align="center">
<td style="vertical-align: top;"><br>
</td>
</tr>

<tr align="center">
<td style="vertical-align: top;">什么是CMA?<br>
</td>
</tr>
<tr>
<td style="vertical-align: top;">分析和记录C/C++程序动态内存状态的GDB Python脚本。<br>CMA 对C/C++程序的性能影响比较小。<br>
CMA 支持 X86_32 和 X86_64。
</td>
</tr>
<tr align="center">
<td style="vertical-align: top;"><br>
</td>
</tr>
<tr align="center">
<td style="vertical-align: top;">如何使用CMA?<br>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<ol>
   <li>CMA只能和GDB 7.5或者更新版本。你可以用<a href="http://teawater.github.io/get-gdb/">Get-GDB</a>检查当前系统的GDB版本并根据需要GDB 7.5或者更新版本。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
wget https://raw.githubusercontent.com/teawater/get-gdb/master/get-gdb.py<br>
python get-gdb.py
</td>
</tbody>
</table>
</li>
   <li>取得CMA。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
wget https://raw.githubusercontent.com/teawater/cma/master/cma.py
</td>
</tbody>
</table>
</li>

<li>
分析的C/C++程序编译的时候要使用GCC的“-g”选项，这样可以取得内存分配和释放时的行信息。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
gcc -g xxx<br>
g++ -g xxx
</td>
</tbody>
</table>
</li>

<li>
GDB控制要分析的C/C++程序。
这里有一些方法：
<ul>
   <li> 和GDB一起打开应用程序。不需要执行程序因为CMA脚本将自动根据需要执行程序。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
gdb xxx
</td>
</tbody>
</table>
</li>
<li>
Attach一个运行中的程序。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
gdb -p pid
</td>
</tbody>
</table>
或者
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
gdb<br>
attach pid
</td>
</tbody>
</table>

</li>
 </ul>
</li>

<li>
在GDB中启动CMA脚本。<br>
其将让你输入一些选项，然后执行程序并分析其内存的分配和释放。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
source cma.py
</td>
</tbody>
</table>
</li>

<li>
CMA脚本和程序执行的时候，可以用CTRL-C打断他们的执行。然后可以让CMA脚本将记录保存在一个CSV文件中。<br>
CSV文件可以被Openoffice或者Excel打开。
<table
style="text-align: left; width: 90%;"
border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td style="vertical-align: top; background-color: rgb(238, 238, 238);">
[0] 记录内存信息到“/home/teawater/tmp/cma.csv”。<br>
[1] 继续。<br>
[2] 退出。<br>
哪个操作？[0]<br>
内存信息存入“/home/teawater/tmp/cma.csv”。<br>
Continuing.
</td>
</tbody>
</table>
</li>
</ol>
</td>
</tr>


<tr align="center">
<td style="vertical-align: top;"><br>
</td>
</tr>

<tr align="center">
<td style="vertical-align: top;">截图<br>
</td>
</tr>

<tr align="center">
<td style="vertical-align: top;">这是一个CSV文件的截图。<br>
<a href="cb.png"><IMG src="cs.png" align="" border="0"></a>
</td>
</tr>

</tbody>
</table>

<br>

<div style="text-align: center;">
<a href="http://teawater.github.io/indexcn.html">我的主页</a>
</div>

</body>
</html>

